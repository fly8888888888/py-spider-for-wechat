# 微信公众号爬虫自动登录功能使用说明

## 📖 功能简介

本项目已集成自动登录功能，可以通过浏览器自动化技术，自动获取微信公众平台的token和cookie，无需手动复制粘贴。

## 🚀 新功能特点

### 1. 自动登录
- ✅ 自动打开Chrome浏览器
- ✅ 自动导航到微信公众平台
- ✅ 等待用户扫码登录
- ✅ 自动提取token和cookie
- ✅ 自动填入到爬虫界面

### 2. 智能缓存
- ✅ 登录信息自动缓存4天
- ✅ 自动验证缓存有效性
- ✅ 过期自动清理
- ✅ 启动时自动检查登录状态

### 3. 用户体验
- ✅ 可视化登录状态显示
- ✅ 实时状态更新
- ✅ 错误提示和处理
- ✅ 一键重新登录

## 📋 使用前准备

### 1. 安装依赖
```bash
# 安装所有依赖（包括selenium）
pip install -r requirements.txt
```

### 2. 安装Chrome浏览器
- **Windows**: 从[Google Chrome官网](https://www.google.com/chrome/)下载安装
- **macOS**: 从App Store或官网下载安装
- **Linux**: 使用包管理器安装
  ```bash
  # Ubuntu/Debian
  sudo apt-get install google-chrome-stable
  
  # CentOS/RHEL
  sudo yum install google-chrome-stable
  ```

### 3. ChromeDriver（自动管理）
- ✅ 项目使用Selenium Manager自动管理ChromeDriver
- ✅ 无需手动下载和配置
- ✅ 自动匹配Chrome版本

## 🎯 使用步骤

### 方法一：自动登录（推荐）

1. **启动程序**
   ```bash
   python main.py
   ```

2. **检查登录状态**
   - 程序启动时会自动检查是否已有有效登录
   - 状态显示在"用户登录"区域顶部

3. **执行自动登录**
   - 点击"自动登录"按钮
   - 等待Chrome浏览器自动打开
   - 在浏览器中扫码登录微信公众平台
   - 登录成功后浏览器会自动关闭
   - Token和Cookie会自动填入界面

4. **开始爬取**
   - 登录成功后即可正常使用爬虫功能
   - 无需手动输入任何认证信息

### 方法二：手动输入（备用）

如果自动登录失败，仍可使用原有的手动方式：

1. 手动登录微信公众平台
2. 按F12打开开发者工具
3. 复制token和cookie
4. 粘贴到对应输入框

## 🔧 界面说明

### 用户登录区域新增元素：

1. **登录状态标签**
   - 🟢 绿色：已登录
   - 🟠 橙色：登录中
   - 🔴 红色：登录失败/过期
   - ⚪ 灰色：未登录

2. **自动登录按钮**
   - "自动登录"：执行新的登录
   - "重新登录"：已登录状态下重新登录
   - "登录中..."：登录过程中（按钮禁用）

3. **状态信息**
   - 显示登录时间
   - 显示过期时间
   - 显示错误信息

## ⚡ 登录流程详解

### 自动登录过程：

```
1. 点击"自动登录" 
   ↓
2. 检查缓存是否有效
   ↓
3. 如缓存有效 → 直接使用
   如缓存无效 → 继续登录流程
   ↓
4. 启动Chrome浏览器
   ↓
5. 导航到微信公众平台
   ↓
6. 用户扫码登录
   ↓
7. 检测登录成功（URL包含token）
   ↓
8. 提取token和cookies
   ↓
9. 保存到缓存文件
   ↓
10. 自动填入界面
    ↓
11. 关闭浏览器，清理临时文件
```

## 📁 缓存文件说明

### 缓存文件位置
```
项目根目录/wechat_cache.json
```

### 缓存内容
```json
{
  "token": "登录令牌",
  "cookies": {
    "cookie名": "cookie值",
    "...": "..."
  },
  "timestamp": 1703123456.789
}
```

### 缓存管理
- **有效期**: 4天（96小时）
- **自动验证**: 每次使用前验证有效性
- **自动清理**: 过期自动删除
- **手动清理**: 点击"全部清空"按钮

## 🛠️ 故障排除

### 常见问题及解决方案：

#### 1. 自动登录按钮灰色/不可用
**原因**: selenium依赖未安装
**解决**: 
```bash
pip install selenium~=4.15.0
```

#### 2. Chrome浏览器启动失败
**原因**: 
- Chrome未安装
- Chrome版本过旧
- ChromeDriver不兼容

**解决**: 
- 安装/更新Chrome浏览器
- 重启程序（Selenium Manager会自动处理）

#### 3. 登录超时
**原因**: 
- 网络连接问题
- 扫码时间过长（超过5分钟）

**解决**: 
- 检查网络连接
- 重新点击"自动登录"
- 在5分钟内完成扫码

#### 4. Token验证失败
**原因**: 
- 登录信息已过期
- 网络连接问题
- 微信平台限制

**解决**: 
- 点击"重新登录"
- 检查网络连接
- 等待一段时间后重试

#### 5. 缓存文件损坏
**原因**: 
- 文件权限问题
- 磁盘空间不足
- 程序异常退出

**解决**: 
- 点击"全部清空"清除缓存
- 检查磁盘空间
- 重新登录

## 🔒 安全说明

### 数据安全
- ✅ 登录信息仅保存在本地
- ✅ 不会上传到任何服务器
- ✅ 使用临时浏览器数据目录
- ✅ 自动清理敏感信息

### 隐私保护
- ✅ 隐藏浏览器自动化特征
- ✅ 使用标准用户代理
- ✅ 不记录个人敏感信息
- ✅ 支持手动清除所有数据

## 📞 技术支持

如果遇到问题，请按以下顺序尝试：

1. **查看控制台输出**: 程序会输出详细的错误信息
2. **检查依赖安装**: 确保所有依赖包已正确安装
3. **重启程序**: 有时重启可以解决临时问题
4. **手动登录**: 使用传统的手动复制方式作为备用
5. **联系作者**: wsz2002@foxmail.com

## 🔄 版本更新

### v1.1.0 新增功能
- ✅ 自动登录功能
- ✅ 智能缓存管理
- ✅ 登录状态显示
- ✅ 错误处理优化
- ✅ 用户体验改进

### 兼容性
- ✅ 完全兼容原有手动输入方式
- ✅ 不影响现有爬虫功能
- ✅ 可选择使用自动或手动登录

---

**享受更便捷的微信公众号爬虫体验！** 🎉 